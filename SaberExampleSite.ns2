Newsqueak2
'Saber'

class SaberExampleSite usingPlatform: p = (
"
Quick start: Saber withSite: (SaberExampleApplication usingPlatform: Platform new)

Copyright 2009 Jeff Olson

Licensed under the Apache License, Version 2.0 (the 'License'); you may not use this file except in compliance with the License. You may obtain a copy of the License at 

    http://www.apache.org/licenses/LICENSE-2.0 

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. 
"
|
	platform = p.
	HttpResponse = p HttpResponse.
	NS2Reflection = p NS2Reflection.
	SaberHandler = p SaberHandler.
	FileDirectory = p FileDirectory.
	
	port = nil.
	name = nil.
	SaberNotFoundHandler = p SaberNotFoundHandler.
	SaberParameterHandler = p SaberParameterHandler.
	SaberStaticFileHandler = p SaberStaticFileHandler.
	SaberView = p SaberView.
	Dictionary = p Dictionary.
|
port:: 8083.
name:: 'TestSite1'.
)
(

class Domain = (
"Describe the class in this comment."
|
|
)
(

class FooService = (
"Describe the class in this comment."
|
|
)
('as yet unclassified'
getThing = (
	^ 'Hello world from FooService!'
)

))

class Views = (
"container for all of the Views in SaberExampleSite"
|
|
)
(

class MainBase platform: p parent: theP = SaberView platform: p parent: theP (
|
|
)
('as yet unclassified'
content = (
	^ ''
)

)

class SiteRootView platform: p parent: theP = SaberView platform: p parent: theP(|
|
)
('as yet unclassified'
content = (
	^ defineRawMarkup: [
	'
<html>
	<head>
		<title>SaberExampleSite</title>
	</head>
	<body>
		{ content }
	</body>
</html>
	'
	].
)

))

class SiteRoot = SaberHandler(
"Describe the class in this comment."
|
|
)
(

class static = SaberStaticFileHandler (
|
|
)
('as yet unclassified'
documentRoot = (
	^ (FileDirectory default fullName, FileDirectory slash, 'static')
)

)

class foo = SaberHandler(
"/foo"
|
|
)
('as yet unclassified'
onGet: request = (
	| fooService |
	fooService:: Domain new FooService new.
	^ HttpResponse fromString: 'GET handler for /foo. ', fooService getThing.
)

)

class bar = SaberHandler (
"/bar"
|
|
)
(

class nameParam = SaberParameterHandler (
"/bar/{nameParam}"
|
|
)
(

class show = SaberHandler(
"/bar/{nameParam}/show"
|
|
)
('as yet unclassified'
onGet: request = (
	| wife |
	wife:: request getFields at: 'wife' ifAbsent: [ 'your sister' ].
	^ HttpResponse fromString: 'Hi, ', (request getFields at: 'nameParam'), '! How is ', wife, '?'
)

))

class baz = SaberHandler (
"/bar/baz -- no overriden method handlers."
|
|
)
())

class NotFound = SaberNotFoundHandler(
|
|
)
('as yet unclassified'
onGet: request = (
	^ HttpResponse fromString: ('route: "', request url, '" was not found.')
)

)'as yet unclassified'
getView = (
	| base |
	base:: (Views new MainBase platform: platform parent: nil). 
	^ Views new SiteRootView platform: platform parent: base.
)

onGet: request = (
	| body model view |
	view:: getView.
	view model at: 'content' put: 'hello world!!! view engine works.'.
	body:: view render.
	^HttpResponse fromString: body.
)

))